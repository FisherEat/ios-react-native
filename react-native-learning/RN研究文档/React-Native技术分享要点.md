### React-Native技术分享要点

*大家都清楚，React-Native就是在开发效率和用户体验间做的一种权衡。React-native是使用JS开发，开发效率高、发布能力强，不仅拥有hybrid的开发效率，同时拥有native app相媲美的用户体验。facebook2015年初推出至今，2015年10月退出安卓版。*

#### 入门篇

##### iOS搭建react-native开发环境

需要搭建的环境包括：`node`  、`react-native`。搭建node环境是为了更好的调试js代码、react-native其实是一个js包。一站式解决方案，有以下几个步骤：

1. 安装`brew`

   ```sh
     $ ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
   ```

2. 安装`nvm`

   `nvm`即`node version manager`，通过brew安装

   ```sh
   $ brew install nvm 
   $ nvm --version
   #如果出现以下提示，是因为找不到nvm命令
   You should create NVM's working directory if it doesn't exist:
   mkdir ~/.nvm
   Add the following to ~/.zshrc or your desired shell
   configuration file:
   export NVM_DIR=~/.nvm
   source $(brew --prefix nvm)/nvm.sh
   #解决方案
   在系统根目录下找到  ~/.bashrc_profile、~/.bashrc 、~/.zshrc这三个文件（没有这些文件就创建该文件），配置好nvm路径:

   export NVM_DIR=~/.nvm
   source $(brew --prefix nvm)/nvm.sh

   ```

3. 安装`node`

   ```sh
   #如果安装过node,可以先删除，不强制。通过下面命令安装node
   $ nvm install node 
   $ nvm alias defautl node 
   #安装路径
   $ ~/.nvm/versions/node/v5.6.0/lib/node_modules/npm

   #安装好node,其包管理工具npm(类似Pod), node package manager也安装好了
   npm ls #查看当前目录下安装的包
   npm ls -g #查看全局安装的包
   npm install xxx #安装xxx包
   npm uninstall xxx
   npm info xxx 
   npm install xxx --save #安装xxx包，并将xxx依赖命令写入package.json
   npm update xxx

   ```

4. 安装`watchman`

   ```sh
   $ brew install watchman
   $ watchman --version
   # 如果调试RN项目的时候报watchman错误，可能是watchman版本太低
   ```

5. 安装`flow`

   ```sh
   $ brew install flow
   ```

6. 安装`nrm` 

   `nrm` nrm为管理node包源地址的管理器,

   ```sh
   $ npm install -g nrm
   $ nrm ls 
   $ nrm use taobao 
   ```

7. 安装`react-native`

   ```sh
   $ npm install -g react-native-cli
   ```

8. over

##### React-Native小小实践

1. 创建项目

   ```sh
     $ react-native init MyFirstRNProject
     #node_modules为js第三方包，
     #package.json为RN依赖管理配置文件，类似Podfile
     #index.ios.js js入口文件
     #npm-debug.log调试日志，每次调试时会打开一个shell窗口#ios、android文件夹
   ```

2. 启动

   `React`部分

   ```javascript
   /**
    * Sample React Native App
    * https://github.com/facebook/react-native
    */

   import React, {
     AppRegistry,
     Component,
     StyleSheet,
     Text,
     View
   } from 'react-native';

   class myRN extends Component {
     render() {
       return (
         <View style={styles.container}>
           <Text style={styles.welcome}>
             Welcome to React Native!
           </Text>
           <Text style={styles.instructions}>
             To get started, edit index.ios.js
           </Text>
           <Text style={styles.instructions}>
             Press Cmd+R to reload,{'\n'}
             Cmd+D or shake for dev menu
           </Text>
         </View>
       );
     }
   }

   const styles = StyleSheet.create({
     container: {
       flex: 1,
       justifyContent: 'center',
       alignItems: 'center',
       backgroundColor: '#F5FCFF',
     },
     welcome: {
       fontSize: 20,
       textAlign: 'center',
       margin: 10,
     },
     instructions: {
       textAlign: 'center',
       color: '#333333',
       marginBottom: 5,
     },
   });

   AppRegistry.registerComponent('myRN', () => myRN);
   ```

   `Native`部分

   ```objective-c

   #import "AppDelegate.h"

   #import "RCTRootView.h"

   @implementation AppDelegate

   - (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
   {
     NSURL *jsCodeLocation;

     /**
      * Loading JavaScript code - uncomment the one you want.
      *
      * OPTION 1
      * Load from development server. Start the server from the repository root:
      *
      * $ npm start
      *
      * To run on device, change `localhost` to the IP address of your computer
      * (you can get this by typing `ifconfig` into the terminal and selecting the
      * `inet` value under `en0:`) and make sure your computer and iOS device are
      * on the same Wi-Fi network.
      */

     jsCodeLocation = [NSURL URLWithString:@"http://localhost:8081/index.ios.bundle?platform=ios&dev=true"];

     /**
      * OPTION 2
      * Load from pre-bundled file on disk. The static bundle is automatically
      * generated by the "Bundle React Native code and images" build step when
      * running the project on an actual device or running the project on the
      * simulator in the "Release" build configuration.
      */

   //   jsCodeLocation = [[NSBundle mainBundle] URLForResource:@"main" withExtension:@"jsbundle"];

     RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation
                                                         moduleName:@"myShitRN"
                                                  initialProperties:nil
                                                      launchOptions:launchOptions];

     self.window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];
     UIViewController *rootViewController = [UIViewController new];
     rootViewController.view = rootView;
     self.window.rootViewController = rootViewController;
     [self.window makeKeyAndVisible];
     return YES;
   }
   ```

3. 创建项目

4. react与native的链接方式（react指代js代码、native指代OC代码）

   ```sh
   #react本质上是写一个View,然后native这边[self.view addSubView:reactView]方式添加，react是来写视图的。
   #当然react也可以处理数据，可以通过集成Redux \Flux等 MVVM框架，处理数据。
   ```

##### 现有项目集成react-native

1. 配置`package.json`文件

     在项目根目录下添加package.son，并运行npm install安装相关依赖，注意配置不全可能导致解析不了js代码

   ```sh
     {
     "name": "Demos",
     "version": "0.0.1",
     "private": true,
     "scripts": {
     "start": "react-native start"
     },
     "dependencies": {
     "react": "0.14.5", 
     "react-native": "^0.22.1"
     }
     }
   ```

2. 添加入口文件`index.os.js`

3. native项目`Podfile`添加相关依

   该安装方式是软连接，具体私有库的位置在`node_modules/react-native/Libraries`文件夹里，具体的私有库可以查看`React.spec`配置文件。

   这里不推荐用`pod  React`从Gi仓库直接安装的方式，因为版本很老。

   ```sh
   //在你的podfile文件中添加这么一段，通过私有库的形式加载reactnative依赖
   pod 'React', :path => './node_modules/react-native', :subspecs => [
   'Core',
   'RCTImage',
   'RCTNetwork',
   'RCTText',
   'RCTWebSocket',
   'ART',
   'RCTActionSheet',
   'RCTGeolocation',
   'RCTPushNotification',
   'RCTSettings',
   'RCTVibration',
   'RCTLinkingIOS',
   ]
   ```

4. 启动与调试

   新建一个ViewController，我在TuNiu_PRO集成时，封装了一个TNSpringBoard，该文件会被注册，被js代码调用，用来实现js与native通讯。

   ```objective-c
   jsCodeLocation = [NSURL URLWithString:@"http://localhost:8081/index.ios.bundle?platform=ios&dev=true"];
   //jsCodeLocation = [NSURL URLWithString:@"http://192.168.1.116:8081/index.ios.bundle?platform=ios&dev=false"];
   //jsCodeLocation = [[NSBundle mainBundle] URLForResource:@"main" withExtension:@"jsbundle"];
   RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation                                                    moduleName:@"XTMedic"                                  initialProperties:@{@"classname": classname}  launchOptions:nil];
   rootView.frame = [UIScreen mainScreen].bounds;
   [self.view addSubView:rootView]
   ```

5. 启动项目

   ```sh
   $ cd xxx
   $ cd node_modules/react-native
   $ npm run start 

   #一站式脚本
   set -e
   set -x
   CURRENT_WORK_DIR=`echo ${0%/*}`
   if [ -d ${CURRENT_WORK_DIR} ];then
   cd ${CURRENT_WORK_DIR}
   fi
   SCRIPT_PATH=`pwd`
   cd "${SCRIPT_PATH}"
   npm_run()
   {
   cd node_modules/react-native
   npm run start
   }
   npm_run
   ```

6. 报错

   ```sh
   "Unable to resolv module LinkedStateMixin from /User/gaolong/Desktop/TextRN_Native/node_modules/react-native/Libraries/react-native/react-native.js:Unable to find this module map or any of the node_modules directories under /User/node_modules/LinkedStateMixin and its parent directoies"
   #package.json文件配置不全，缺东西
   ```

##### iOS搭建调试环境

1. 在键盘中按`CMD+R`可以刷新react页面，可以实时更新js代码。如果键盘没有响应，请确保模拟器中选中了`Connect Hardware keyboard` 
2. CMD+D`可以打开模拟器上的选择调试页面。
   - `Reload` 刷新页面
   - `Debug in Chrome`，使用谷歌浏览器调试react-native。谷歌浏览器内置V8 JavaScript引擎，与iOS内置的JavaScriptCore引擎差别很小。
   - `Show inspector` 类似于iOS的Flex ,可以用于UI调试
3. `Debug in Chrome`  使用谷歌浏览器断点调试
4. 查看报错信息
5. 在真机上调试和运行

##### ES6语法介绍

##### React组件生命周期

![http://7rf9ir.com1.z0.glb.clouddn.com/3-3-component-lifecycle.jpg](http://7rf9ir.com1.z0.glb.clouddn.com/3-3-component-lifecycle.jpg)

##### React与Native之间的通讯

1. react调用native方法

     ```
     #native注册方法
     #react调用注册的方法
     #react回调
     ```

2. native调用react方法

   ```
   #native生成react页面
   #native向react传值
   #native向react发消息
   ```

3. react页面之间传值

   ```
   #props
   #state
   ```

4. over

##### React布局篇

1. css样式表
2. flexbox

##### 对包大小的影响

##### 打包与热更新

1. 热更新的方式和jspatch类似
2. 搭建一套完整的热更新环境

#### 进阶篇

##### react-native通讯原理

*JS是如何能够调用到Native方法和参数的，*

1. 以react调native方法为例，


##### react-native增量更新方案

##### RN性能分析

##### JS高级语法与Node.js

#### 高级篇

##### react-native源码解读

##### React-Native VS Weex

#### 



